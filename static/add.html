<!-- static/add.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Agregar Eficiencia</title>
  <!-- Enlaza el CSS que montas en /static -->
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <!-- Bot√≥n de navegaci√≥n con clase -->
    <button class="nav-btn" onclick="location.href='/'">
      üìä Ver Dashboard
    </button>

    <h1>Agregar Nuevo Registro</h1>

    <!-- Tarjeta de formulario -->
    <form id="efForm" class="form-card">
      <div class="form-group">
        <label>Nombre del Asociado</label>
        <input name="nombre_asociado" required placeholder="Nombre y primer apellido" />
      </div>

      <div class="form-group">
        <label>L√≠nea</label>
        <input name="linea" required placeholder="p.ej. L27" />
      </div>

      <div class="form-group">
        <label>Supervisor</label>
        <input name="supervisor" required placeholder="Nombre y apellido" />
      </div>

      <div class="form-group">
        <label>Tipo de Proceso</label>
        <select name="tipo_proceso" required>
          <option value="">-- seleccionar --</option>
          <option value="SW">SW</option>
          <option value="WD">WD</option>
        </select>
      </div>

      <div class="form-group">
  <label>Piezas Producidas</label>
  <input name="piezas" type="number" min="1" step="1" required placeholder="p.ej. 500" />
</div>


      <div class="form-group">
        <label>Proceso (descripci√≥n)</label>
        <input name="proceso" required placeholder="p.ej. Drill" />
      </div>

      <div class="form-group">
        <label>Eficiencia del Asociado (%)</label>
        <input name="eficiencia_asociado" type="number" step="0.1" required />
      </div>

      <div class="form-group">
        <label>Semana del A√±o (1‚Äì53)</label>
        <input name="semana" type="number" min="1" max="53" required />
      </div>

      <div class="form-group">
        <label>Turno</label>
        <input name="turno" required placeholder="p.ej. 1er, 2do, 3er" />
      </div>

        <!-- ‚Ä¶otros form-groups‚Ä¶ -->
    <div class="form-group">
    <label>Tiempo Muerto (minutos)</label>
    <input name="tiempo_muerto" type="number" min="0" step="0.1"placeholder="p.ej. 15.5 (opcional)" />
    </div>
    <button type="submit" class="btn-primary">Guardar Registro</button>

    </form>

    <div class="msg" id="msg"></div>
  </div>

  <script>
    // Encapsulamos para no contaminar el scope global
    (function(){
      const form = document.getElementById('efForm');
      const msg   = document.getElementById('msg');

      form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Recolectamos los campos
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        // Convertimos los valores num√©ricos
        data.eficiencia_asociado = Number(data.eficiencia_asociado);
        data.semana = Number(data.semana);

        // tras convertir eficiencia_asociado y semana:
        data.piezas = Number(data.piezas);
        data.tiempo_muerto = data.tiempo_muerto
      Number(data.tiempo_muerto)
       0.0;


        try {
          const res = await fetch('/api/eficiencias', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          if (!res.ok) {
            const text = await res.text();
            throw new Error(text);
          }
          msg.textContent = '‚úÖ Registro guardado correctamente';
          form.reset();
        } catch(err) {
          msg.textContent = '‚ùå Error: ' + err.message;
        }
      });
    })();
  </script>
</body>
</html>
